from audio import *
import struct
mels= np.load('/home/zzh/GTA/gta/speech-mel-00001.npy')
mels1= np.load('mels.npy')
window = np.load('/home/zzh/work/C_project/inv_mel/ifft_window.npy')
mels1 = mels1.T.reshape(-1)
inv_mel_basis = np.load('inv_mel_basis.npy')
mels1 = inv_mel_basis.T.reshape(-1)
mels1 = window.reshape(-1)
with open('ifft_window','wb') as fd:
    for i in range(len(mels1)):
        
        bi = struct.pack('f',mels1[i])
        fd.write(bi)


wav = inv_mel_spectrogram(mels.T)

save_wav(wav,'wav_1.wav')
'''
mels1[10000:10100]
array([-1.05006549e-15,  1.17155798e-15,  1.04054637e-17,  6.71996869e-16,
        3.35282606e-16, -1.04139572e-15, -4.03605376e-16,  3.89432344e-17,
       -7.21641331e-16, -9.55795623e-16,  7.35087877e-16, -9.46366813e-16,
       -2.93066278e-16,  1.09919983e-15, -1.85570376e-16, -3.47956561e-15,
        1.51774098e-14, -5.21870234e-14,  1.68704758e-13, -6.05526233e-13,
        2.50736293e-12, -9.51809533e-12,  3.17691450e-11, -1.12810688e-10,
        4.72073647e-10, -1.84297730e-09,  6.84046921e-09, -2.79312160e-08,
        1.00885060e-07, -4.12393139e-07,  1.60494976e-06, -5.74815515e-06,
        2.03243043e-05, -7.43689133e-05,  2.89956053e-04, -1.13334728e-03,
        4.30718320e-03, -1.75072507e-02,  6.40179546e-02, -2.31296325e-01,
        8.42208101e-01, -3.07110826e+00,  1.16537986e+01,  8.03751746e+00,
       -2.22373063e+00,  5.95311542e-01, -1.59935076e-01,  4.41716954e-02,
       -1.20900657e-02,  3.35276916e-03, -9.29776144e-04,  2.57404641e-04,
       -7.12378137e-05,  1.93564471e-05, -5.21016931e-06,  1.40522734e-06,
       -3.79885307e-07,  1.04120317e-07, -2.87644583e-08,  7.93312949e-09,
       -2.15616508e-09,  5.90260644e-10, -1.62215107e-10,  4.39740213e-11,
       -1.20013971e-11,  3.28952431e-12, -8.94278488e-13,  2.42470826e-13,
       -6.51843486e-14,  1.86078641e-14, -4.68542118e-15,  1.47629743e-15,
       -3.80627228e-16,  6.24239168e-17, -2.49289584e-16, -2.24723428e-16,
       -1.35744576e-16, -4.77183722e-17, -3.91667069e-17, -1.84205963e-17,
       -4.67427730e-16,  6.83830532e-17,  8.17414214e-16,  3.93816270e-16,
        3.13316635e-16, -1.05786038e-15, -2.74131702e-16,  2.34834942e-16,
       -1.22495297e-15, -3.45218091e-16,  6.82893978e-17, -8.28927103e-16,
       -4.64555914e-17,  8.55238653e-16, -4.88819030e-16, -1.23052903e-15,
        6.39689486e-15, -2.00173555e-14,  6.28844545e-14, -2.24549776e-13])

    
_inv_mel_basis[0]
array([-4.34828835e-16,  1.63410607e-15, -2.62158397e-16,  2.91828894e-17,
       -3.01754721e-17,  2.32615510e-18,  2.40671431e-17, -1.05964370e-16,
        4.64640675e-16, -1.69162227e-15, -3.76251782e-18,  1.39979576e-17,
       -5.96577044e-17,  2.19774402e-16, -1.73168427e-17,  2.30507644e-17,
       -5.62526496e-18,  2.41334491e-19, -8.03017767e-19,  2.88989904e-18,
        1.06485048e-18,  1.96697633e-18, -6.56411920e-18,  1.01054652e-17,
       -4.22881187e-17,  1.65093559e-16, -5.90402227e-18,  8.85117369e-16,
       -1.57011189e-15,  2.77847372e-15, -3.77175036e-15,  9.38818078e-18,
       -3.31946926e-17,  2.04299920e-15,  1.35887531e-15, -2.84460453e-16,
        2.19496959e-15, -3.14983133e-16, -1.35675286e-16,  4.42179214e-16,
       -4.72269380e-17,  2.92661348e-17, -5.73391680e-18,  6.71590509e-19,
       -4.50639994e-19,  4.92877315e-20, -8.99988687e-20, -1.34865607e-20,
       -3.60875768e-20,  3.84961745e-19,  1.22137280e-19, -3.03989292e-19,
       -9.97264409e-21, -1.12742833e-18,  1.06875453e-18, -6.99182323e-19,
        4.20413782e-18, -1.79836904e-18,  1.68707844e-18,  4.16476556e-18,
       -4.48878172e-18, -1.72795873e-18,  1.32423394e-17, -9.90233734e-18,
        5.37975310e-18, -1.79698601e-17,  3.61708051e-17, -5.80911383e-17,
       -1.31128700e-17,  1.04307682e-16, -2.26580999e-16,  9.97927272e-17,
       -1.20875485e-16,  1.64183278e-16,  1.75876817e-16, -2.38920311e-16,
       -9.48740615e-18,  1.16665851e-16, -1.17000718e-16,  9.71809598e-17])
    
    
    
mel_spectrogram[0]
array([3.88586137e-04, 5.61267429e-04, 8.68532865e-04, 1.87053659e-03,
       9.10221785e-03, 3.25450189e-02, 5.33373840e-02, 5.54796048e-02,
       1.77873392e-02, 6.97774254e-03, 7.40112923e-03, 6.39781542e-03,
       4.53359680e-03, 4.13179910e-03, 4.02493356e-03, 4.66588605e-03,
       3.85867269e-03, 5.89574967e-03, 8.11936893e-03, 8.66158772e-03,
       6.21990720e-03, 4.80643427e-03, 4.73003183e-03, 8.72472115e-03,
       1.94434226e-02, 1.60830151e-02, 8.43984354e-03, 1.09175965e-02,
       2.63864379e-02, 3.80846187e-02, 3.46415378e-02, 3.10385562e-02,
       2.94671282e-02, 1.66497938e-02, 8.68920144e-03, 8.30813311e-03,
       6.49601268e-03, 5.52008161e-03, 6.71598269e-03, 6.65919855e-03,
       1.05225835e-02, 1.54647827e-02, 1.76678933e-02, 1.14494376e-02,
       8.96394905e-03, 8.59441422e-03, 7.05288025e-03, 6.23635668e-03,
       6.78615179e-03, 1.98480207e-02, 5.61017878e-02, 4.84219640e-02,
       3.28511372e-02, 6.11405559e-02, 1.09614149e-01, 1.15278043e-01,
       9.63484049e-02, 7.75550231e-02, 4.56670672e-02, 2.68768445e-02,
       1.87099203e-02, 1.27363913e-02, 1.11497082e-02, 1.13781504e-02,
       1.49169508e-02, 1.26080401e-02, 7.85091240e-03, 4.87187877e-03,
       4.45026159e-03, 4.83038928e-03, 6.59942627e-03, 4.21880819e-02,
       8.19998831e-02, 4.67195399e-02, 8.16123374e-03, 6.56283088e-03,
    
     np.dot(_inv_mel_basis, mel_spectrogram).reshape(-1)[:100]
array([ 4.34890595e-19,  5.45943267e-19,  5.90635075e-19,  8.76018693e-19,
        2.73515498e-18, -4.96091862e-18, -4.39292550e-17, -1.70454621e-16,
        3.88687443e-16, -1.47385529e-15, -3.04362473e-15, -3.77392413e-15,
       -4.90474118e-15, -4.67524948e-15, -9.54862286e-17,  1.31831028e-15,
        5.34307650e-16,  4.65602484e-16,  1.56568215e-16,  5.60440193e-18,
        1.10236793e-17,  1.61863629e-17,  1.52102851e-17,  1.79956441e-17,
        2.70534510e-17,  3.70026147e-17, -1.70653302e-15, -3.80672669e-15,
       -2.49922296e-15, -3.00398211e-16,  3.03651304e-17,  3.63562214e-17,
        5.38544778e-18, -2.54444102e-17, -3.61190092e-17,  1.51854991e-17,
       -6.18624410e-19, -2.76905705e-17, -7.32122135e-17, -4.67874043e-17,
       -2.10512848e-17, -5.80852658e-17, -4.10733078e-17,  2.18865473e-17,
        2.87452299e-17,  2.61641139e-17,  2.55159989e-17,  2.45823674e-17,
        2.37767892e-17,  2.17455899e-17, -6.05819848e-16, -1.38436033e-15,
        8.29513502e-18,  2.71334516e-15,  2.88301150e-15,  2.83050158e-15,
        2.40770696e-15,  2.39851705e-15,  1.92389569e-15,  1.09298142e-15,
       -1.63674974e-15, -3.00716236e-15, -1.08028236e-15, -1.58314381e-16,
        1.63738650e-17,  3.71586807e-17,  2.74940949e-17,  1.59271875e-17,
        1.38687464e-17,  1.79534687e-17,  7.28229193e-18, -4.44273708e-16,
       -2.45650760e-16,  1.02754776e-15,  1.18028938e-15,  1.94786722e-15,
        1.55063745e-15,  6.63790484e-16,  2.24759125e-16,  2.69918787e-17,
       -2.00667212e-17, -4.89277084e-17, -3.69596404e-17,  1.35265752e-17,
       -1.72383779e-18,  1.27109054e-17, -8.93742340e-16, -1.02015213e-15,
       -2.59872303e-15, -1.23359965e-15,  9.52834442e-16,  1.17536646e-15,
        8.46537220e-16,  2.48731271e-16,  1.87842395e-16,  2.41812221e-17,
        1.28390258e-16,  1.78064875e-16,  5.97228170e-17,  3.48208389e-17])
'''